\documentclass[tikz]{standalone}

\input{figures/common/preamble}
\usepackage{minted}
\usepackage{amsmath}
\usepackage{mymacros}

\begin{document}
\begin{tikzpicture}[yscale=-1]

\input{figures/common/ast.tikz}

% before
\node (parent) [element,anchor=center] at (0,0) {\pycodemini{loop(p := axes.index())}};
\node (child) [element,anchor=center] at (0,1.5) {\pycodemini{kernel(dat0[map0(p), :], dat1[p])}};

\draw (parent) -- (child);

% after
\node (root) [element] at (8,0) {\pycodemini{loop(p := axes.index())}};
\node (one) [element] at (3,1.5) {\pycodemini{write(t0, dat0[map0(p), :])}};
\node (two) [element] at ($(one.east)+(.2,0)$) {\pycodemini{write(t1, 0)}};
\node (three) [element] at ($(two.east)+(.2,0)$) {\pycodemini{kernel(t0, t1)}};
\node (four) [element] at ($(three.east)+(.2,0)$) {\pycodemini{inc(dat1[p], t1)}};

\draw (root) -- (one);
\draw (root) -- (two);
\draw (root) -- (three);
\draw (root) -- (four);

\end{tikzpicture}
\end{document}
